<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>D3 Time Line Graph with Icons</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    #chart {
      position: relative;
    }

    .line {
      stroke: #d3d3d3;
      stroke-width: 12px;
    }

    .tooltip {
      position: absolute;
      position-anchor: --anchor-1-0;
      bottom: anchor(top);
      justify-self: anchor-center;
      margin-bottom: 4px;

      /* visibility: hidden; */
      background-color: lightgray;
      padding: 8px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div id="chart"></div>
  <script>
    const iconSize = 24;

    const data = [
      { line: 1, start: 0, end: 600, times: [0, 300, 600] },
      { line: 2, start: 0, end: 600, times: [15, 45, 90, 400, 450] },
      { line: 3, start: 30, end: 600, times: [125, 250, 375, 500] },
      { line: 4, start: 0, end: 450, times: [30, 90, 120, 180] }
    ];

    const margin = { top: 16, right: 16, bottom: 16, left: 16 },
      width = 960 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    const chartContainer = d3.select("#chart");

    const svg = chartContainer.append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .style("transform", `translate(${margin.left}px,${margin.top}px)`);

    const x = d3.scaleLinear()
      .domain([0, 600])
      .range([0, width]);

    const xDom = d3.scaleLinear()
      .domain([0, 600])
      .range([margin.left, width + margin.left]);

    const y = d3.scaleLinear()
      .domain([0, 5])
      .range([0, height]);

    const yDom = d3.scaleLinear()
      .domain([0, 5])
      .range([margin.top, height + margin.top]);

    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x));

    const tooltip = d3.select("#tooltip");

    data.forEach((d, i) => {
      svg.append("line")
        .attr("x1", x(d.start))
        .attr("y1", y(d.line))
        .attr("x2", x(d.end))
        .attr("y2", y(d.line))
        .attr("class", "line");

      d.times.forEach((time, i2) => {
        const anchorName = `--anchor-${i}-${i2}`;
        chartContainer.append("img")
          .attr("src", "public/images/fix.svg")
          .style("position", "absolute")
          .style("left", `${xDom(time) - iconSize / 2}px`)  // Adjust to center the icon
          .style("top", `${yDom(d.line) - iconSize / 2}px`)
          .style("width", `${iconSize}px`)
          .style("height", `${iconSize}px`)
          .style("anchor-name", anchorName)
          .on("mouseover", (event) => {
            const tooltip = d3.select("body").append("div")
              .attr("class", "tooltip")
              .style("visibility", "visible")
              // .style("left", event.pageX + "px")
              // .style("top", event.pageY + "px")
              .style("position-anchor", anchorName)
              // .style("position-anchor", '--test-anchor')
              .text(`Time: ${time}s`);
          })
          .on("mouseout", function () {
            d3.selectAll(".tooltip").remove();
          });
      });

      if (d.start > 0) {
        const anchorName = `--anchor-${i}-start`;

        chartContainer.append("img")
          .attr("src", "public/images/airport.svg")
          .style("position", "absolute")
          .style("left", `${xDom(d.start) - iconSize / 2}px`)  // Adjust to center the icon
          .style("top", `${yDom(d.line) - iconSize / 2}px`)
          .style("width", `${iconSize}px`)
          .style("height", `${iconSize}px`)
          .style("anchor-name", anchorName)
          .on("mouseover", function (event, time) {
            const tooltip = d3.select("body").append("div")
              .attr("class", "tooltip")
              .style("visibility", "visible")
              .style("position-anchor", anchorName)
              .text(`Origin Airport!`);
          })
          .on("mouseout", function () {
            d3.selectAll(".tooltip").remove();
          });

      }

      if (d.end < 600) {
        const anchorName = `--anchor-${i}-end`;

        chartContainer.append("img")
          .attr("src", "public/images/airport.svg")
          .style("position", "absolute")
          .style("left", `${x(d.end) - iconSize / 2 + margin.left}px`)  // Adjust to center the icon
          .style("top", `${y(d.line) - iconSize / 2 + margin.top}px`)
          .style("width", `${iconSize}px`)
          .style("height", `${iconSize}px`)
          .style("anchor-name", anchorName)
          .on("mouseover", function (event, time) {
            const tooltip = d3.select("body").append("div")
              .attr("class", "tooltip")
              .style("visibility", "visible")
              .style("position-anchor", anchorName)
              .text(`Arrival Airport!`);
          })
          .on("mouseout", function () {
            d3.selectAll(".tooltip").remove();
          });
      }

    });
  </script>
</body>

</html>
